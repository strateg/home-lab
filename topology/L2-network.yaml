# L2 Network
# Part of Home Lab Topology v4.0.0
# Logical networking: networks, bridges, trust zones, firewall
# Edit this file then regenerate: python3 scripts/regenerate-all.py

trust_zones:
  untrusted:
    name: Untrusted Zone
    security_level: 0
    color: '#ff0000'
    description: External networks (ISP, Internet, LTE)
    allowed_outbound:
    - any
    allowed_inbound:
    - established
    - related
  user:
    name: User Zone
    security_level: 1
    color: '#ffcc00'
    description: End-user devices (WiFi, LAN, VPN clients)
    allowed_outbound:
    - to:untrusted
    - to:servers:ports:80,443,5432,6379
    allowed_inbound:
    - established
  servers:
    name: Servers Zone
    security_level: 2
    color: '#00cc00'
    description: Proxmox LXC and Orange Pi 5 services
    allowed_outbound:
    - to:untrusted
    allowed_inbound:
    - from:user:ports:80,443,5432,6379
    - from:management
  iot:
    name: IoT Zone
    security_level: 1
    color: '#ff6600'
    description: Smart home devices (isolated)
    allowed_outbound:
    - to:untrusted
    allowed_inbound:
    - established
    isolated: true
  guest:
    name: Guest Zone
    security_level: 0
    color: '#999999'
    description: Guest WiFi (isolated, internet only)
    allowed_outbound:
    - to:untrusted
    allowed_inbound:
    - established
    isolated: true
  management:
    name: Management Zone
    security_level: 3
    color: '#0066cc'
    description: Infrastructure management (Proxmox UI, MikroTik UI)
    allowed_outbound:
    - any
    allowed_inbound:
    - from:admin-ips
networks:
- id: net-wan
  name: WAN (ISP)
  cidr: dhcp
  gateway: dhcp
  dns:
  - 1.1.1.1
  - 8.8.8.8
  dhcp: true
  trust_zone_ref: untrusted
  bridge_ref: null
  vlan: null
  description: Primary ISP connection via MikroTik ether1 (2.5GbE)
  managed_by_ref: mikrotik-chateau
  interface_ref: if-mikrotik-wan
- id: net-lte-failover
  name: LTE Failover
  cidr: dhcp
  gateway: dhcp
  dns:
  - 1.1.1.1
  - 8.8.8.8
  dhcp: true
  trust_zone_ref: untrusted
  bridge_ref: null
  vlan: null
  description: LTE Cat 7 failover connection
  managed_by_ref: mikrotik-chateau
  interface_ref: if-mikrotik-lte
  failover:
    enabled: true
    primary: net-wan
    check_gateway: ping
    failover_threshold: 3
- id: net-lan
  name: LAN
  cidr: 192.168.88.0/24
  gateway: 192.168.88.1
  dns:
  - 192.168.88.1
  dhcp: true
  dhcp_range: 192.168.88.100-192.168.88.200
  trust_zone_ref: user
  bridge_ref: null
  vlan: null
  description: Main LAN network (WiFi + Wired)
  managed_by_ref: mikrotik-chateau
  ip_allocations:
  - ip: 192.168.88.1
    device_ref: mikrotik-chateau
    interface: bridge-lan
    description: MikroTik LAN gateway
  - ip: 192.168.88.2
    device_ref: gamayun
    interface: eth0
    description: Proxmox host
  - ip: 192.168.88.3
    device_ref: orangepi5
    interface: eth0
    description: Orange Pi 5 application server
- id: net-servers
  name: Servers
  cidr: 10.0.30.0/24
  gateway: 10.0.30.1
  dns:
  - 192.168.88.1
  dhcp: false
  trust_zone_ref: servers
  bridge_ref: bridge-vmbr0
  vlan: 30
  description: Server network for Proxmox LXC and Orange Pi 5
  managed_by_ref: mikrotik-chateau
  ip_allocations:
  - ip: 10.0.30.1
    device_ref: mikrotik-chateau
    interface: vlan30
    description: MikroTik servers gateway
  - ip: 10.0.30.2
    device_ref: gamayun
    interface: vmbr0.30
    description: Proxmox bridge IP
  - ip: 10.0.30.50
    device_ref: orangepi5
    interface: eth0.30
    description: Orange Pi 5 server interface
- id: net-guest
  name: Guest WiFi
  cidr: 192.168.30.0/24
  gateway: 192.168.30.1
  dns:
  - 1.1.1.1
  - 8.8.8.8
  dhcp: true
  dhcp_range: 192.168.30.100-192.168.30.200
  isolated: true
  trust_zone_ref: guest
  bridge_ref: null
  vlan: 50
  description: Isolated guest WiFi network
  managed_by_ref: mikrotik-chateau
  firewall_policy: internet-only
  ip_allocations:
  - ip: 192.168.30.1
    device_ref: mikrotik-chateau
    interface: vlan50-guest
    description: MikroTik guest gateway
- id: net-iot
  name: IoT Network
  cidr: 192.168.40.0/24
  gateway: 192.168.40.1
  dns:
  - 192.168.88.1
  dhcp: true
  dhcp_range: 192.168.40.100-192.168.40.200
  isolated: true
  trust_zone_ref: iot
  bridge_ref: null
  vlan: 40
  description: Smart home devices (isolated from main LAN)
  managed_by_ref: mikrotik-chateau
  firewall_policy: internet-only-no-lateral
  ip_allocations:
  - ip: 192.168.40.1
    device_ref: mikrotik-chateau
    interface: vlan40-iot
    description: MikroTik IoT gateway
- id: net-management
  name: Management
  cidr: 10.0.99.0/24
  gateway: 10.0.99.1
  dns:
  - 192.168.88.1
  dhcp: false
  trust_zone_ref: management
  bridge_ref: bridge-vmbr0
  vlan: 99
  description: Management network for infrastructure admin
  managed_by_ref: mikrotik-chateau
  ip_allocations:
  - ip: 10.0.99.1
    device_ref: mikrotik-chateau
    interface: vlan99-mgmt
    description: MikroTik management gateway
  - ip: 10.0.99.2
    device_ref: gamayun
    interface: vmbr0.99
    description: Proxmox Web UI
  - ip: 10.0.99.3
    device_ref: orangepi5
    interface: eth0.99
    description: Orange Pi 5 management
- id: net-vpn-home
  name: VPN Home
  cidr: 10.0.200.0/24
  gateway: 10.0.200.1
  dns:
  - 192.168.88.1
  dhcp: false
  trust_zone_ref: user
  bridge_ref: null
  vlan: null
  description: WireGuard VPN on MikroTik (full LAN access)
  managed_by_ref: mikrotik-chateau
  vpn_type: wireguard
  vpn_endpoint: home.example.com:51820
  ip_allocations:
  - ip: 10.0.200.1
    device_ref: mikrotik-chateau
    interface: wireguard1
    description: WireGuard server
- id: net-tailscale
  name: Tailscale Mesh
  cidr: 100.64.0.0/10
  gateway: null
  dns:
  - 100.100.100.100
  dhcp: false
  trust_zone_ref: user
  bridge_ref: null
  vlan: null
  description: Tailscale mesh VPN (container on MikroTik)
  managed_by_ref: mikrotik-chateau
  vpn_type: tailscale
bridges:
- id: bridge-vmbr0
  device_ref: gamayun
  name: vmbr0
  comment: LAN trunk bridge to MikroTik (VLAN-aware)
  ports:
  - if-eth-builtin
  address: 192.168.88.2/24
  gateway: 192.168.88.1
  network_ref: net-lan
  autostart: true
  vlan_aware: true
  bridge_stp: false
  bridge_fd: 0
routing:
- id: route-proxmox-default
  name: Proxmox Default Route
  device_ref: gamayun
  destination_cidr: 0.0.0.0/0
  next_hop: 192.168.88.1
  gateway_device_ref: mikrotik-chateau
  description: All Proxmox traffic routes through MikroTik
- id: route-lxc-internet
  name: LXC to Internet
  source_network_ref: net-servers
  destination_cidr: 0.0.0.0/0
  next_hop: 10.0.30.1
  gateway_device_ref: mikrotik-chateau
  description: LXC containers route through MikroTik
- id: route-user-servers
  name: User LAN to Servers
  source_network_ref: net-lan
  destination_network_ref: net-servers
  via: 192.168.88.1
  gateway_device_ref: mikrotik-chateau
  description: User devices access servers via MikroTik inter-VLAN routing
- id: route-lte-failover
  name: LTE Failover Route
  device_ref: mikrotik-chateau
  destination_cidr: 0.0.0.0/0
  next_hop: lte1
  priority: 10
  check_gateway: ping
  description: Automatic failover to LTE when ISP is down
firewall_templates:
- id: tmpl-web-access
  name: Web Access Template
  description: Allow HTTP and HTTPS traffic
  ports:
  - 80
  - 443
  protocols:
  - tcp
  action: allow
- id: tmpl-database-access
  name: Database Access Template
  description: Allow common database ports
  ports:
  - 5432
  - 3306
  - 6379
  - 27017
  protocols:
  - tcp
  action: allow
- id: tmpl-ssh-access
  name: SSH Access Template
  description: Allow SSH connections
  ports:
  - 22
  protocols:
  - tcp
  action: allow
  rate_limit:
    enabled: true
    max_connections: 10
    per_seconds: 60
- id: tmpl-management-access
  name: Management Access Template
  description: Allow management protocols (SSH, HTTPS, RDP)
  ports:
  - 22
  - 443
  - 8006
  - 3389
  protocols:
  - tcp
  action: allow
- id: tmpl-icmp-allow
  name: ICMP Allow Template
  description: Allow ping and traceroute
  protocols:
  - icmp
  action: allow
  icmp_types:
  - 0
  - 8
firewall_policies:
- id: fw-default-deny
  name: Default Deny
  priority: 1000
  action: drop
  chain: forward
  description: Drop all traffic by default, allow explicitly
  security_policy_ref: sec-baseline
- id: fw-established-related
  name: Allow Established/Related
  priority: 1
  action: accept
  chain: forward
  connection_state:
  - established
  - related
  description: Allow established and related connections
  security_policy_ref: sec-baseline
- id: fw-servers-internet
  name: Servers to Internet
  priority: 100
  source_zone_ref: servers
  destination_zone_ref: untrusted
  action: accept
  chain: forward
  description: Servers can access internet
  security_policy_ref: sec-baseline
- id: fw-user-servers
  name: User to Server Services
  priority: 200
  source_zone_ref: user
  destination_zone_ref: servers
  ports:
  - 80
  - 443
  - 5432
  - 6379
  - 8096
  - 3000
  - 9090
  protocols:
  - tcp
  action: accept
  chain: forward
  description: User devices can access server services
  security_policy_ref: sec-baseline
- id: fw-guest-isolated
  name: Guest Isolation
  priority: 300
  source_zone_ref: guest
  destination_zones_ref:
  - servers
  - management
  - user
  - iot
  action: drop
  chain: forward
  description: Guest network cannot access any internal networks
  security_policy_ref: sec-baseline
- id: fw-iot-isolated
  name: IoT Isolation
  priority: 300
  source_zone_ref: iot
  destination_zones_ref:
  - servers
  - management
  - user
  - guest
  action: drop
  chain: forward
  description: IoT cannot access other networks (except internet)
  security_policy_ref: sec-baseline
- id: fw-iot-internet
  name: IoT to Internet
  priority: 301
  source_zone_ref: iot
  destination_zone_ref: untrusted
  action: accept
  chain: forward
  description: IoT can access internet
  security_policy_ref: sec-baseline
- id: fw-management-admin
  name: Management Access Control
  priority: 50
  source_network_ref: net-lan
  destination_zone_ref: management
  ports:
  - 8006
  - 443
  - 22
  - 80
  protocols:
  - tcp
  action: accept
  chain: forward
  description: Allow admin access from LAN to management interfaces
  security_policy_ref: sec-baseline
- id: fw-vpn-full-access
  name: VPN Full Access
  priority: 60
  source_network_ref: net-vpn-home
  destination_zones_ref:
  - user
  - servers
  - management
  action: accept
  chain: forward
  description: VPN clients have full network access
  security_policy_ref: sec-baseline
- id: fw-tailscale-access
  name: Tailscale Access
  priority: 61
  source_network_ref: net-tailscale
  destination_zones_ref:
  - user
  - servers
  action: accept
  chain: forward
  description: Tailscale mesh clients can access LAN and servers
  security_policy_ref: sec-baseline
qos:
  enabled: true
  device_ref: mikrotik-chateau
  interface: ether1
  total_bandwidth:
    download_mbps: 100
    upload_mbps: 20
  queues:
  - id: qos-voip
    name: VoIP & Video Calls
    priority: 1
    guarantee_percent: 10
    max_limit_percent: 30
    burst_limit_percent: 50
    burst_time: 2s
    protocols:
    - sip
    - rtp
    - rtcp
    ports:
    - 5060
    - 5061
    - 10000-20000
    dscp_mark: ef
    description: Real-time voice and video
  - id: qos-gaming
    name: Gaming
    priority: 2
    guarantee_percent: 15
    max_limit_percent: 40
    burst_limit_percent: 60
    burst_time: 1s
    ports:
    - 3074
    - 3478-3480
    - 27015-27030
    dscp_mark: af41
    description: Low-latency gaming traffic
  - id: qos-interactive
    name: Interactive
    priority: 3
    guarantee_percent: 20
    max_limit_percent: 60
    protocols:
    - ssh
    - rdp
    - vnc
    ports:
    - 22
    - 3389
    - 5900
    dscp_mark: af31
    description: SSH, RDP, remote access
  - id: qos-streaming
    name: Streaming
    priority: 4
    guarantee_percent: 20
    max_limit_percent: 80
    protocols:
    - https
    layer7:
    - netflix
    - youtube
    - twitch
    dscp_mark: af21
    description: Video streaming services
  - id: qos-web
    name: Web Browsing
    priority: 5
    guarantee_percent: 15
    max_limit_percent: 70
    protocols:
    - http
    - https
    ports:
    - 80
    - 443
    dscp_mark: af11
    description: General web traffic
  - id: qos-bulk
    name: Bulk Transfer
    priority: 6
    guarantee_percent: 10
    max_limit_percent: 90
    protocols:
    - ftp
    - sftp
    - rsync
    ports:
    - 21
    - 22
    - 873
    dscp_mark: be
    description: File transfers, backups
  - id: qos-downloads
    name: Downloads & P2P
    priority: 8
    guarantee_percent: 5
    max_limit_percent: 95
    protocols:
    - bittorrent
    layer7:
    - torrent
    dscp_mark: cs1
    description: Low priority bulk downloads
  device_limits:
  - network_ref: net-iot
    download_limit_mbps: 10
    upload_limit_mbps: 5
    description: IoT devices limited bandwidth
  - network_ref: net-guest
    download_limit_mbps: 20
    upload_limit_mbps: 10
    per_host_limit: true
    description: Guest network per-device limit
ipv6:
  enabled: false
  mode: dual-stack
  wan:
    method: dhcpv6-pd
    prefix_hint: /56
    interface_ref: if-mikrotik-wan
  prefix_delegation:
    enabled: true
    pool_name: ipv6-pool
    prefix_length: 64
  networks:
  - id: net-lan-v6
    network_ref: net-lan
    prefix: auto
    slaac: true
    ra_interval: 200-600
    dns:
    - 2606:4700:4700::1111
    - 2001:4860:4860::8888
  - id: net-servers-v6
    network_ref: net-servers
    prefix: auto
    slaac: false
    dhcpv6: true
  - id: net-guest-v6
    network_ref: net-guest
    prefix: auto
    slaac: true
    isolated: true
  - id: net-iot-v6
    network_ref: net-iot
    prefix: auto
    slaac: true
    isolated: true
  firewall:
    default_policy: drop
    allow_icmpv6: true
    icmpv6_types:
    - echo-request
    - echo-reply
    - router-solicitation
    - router-advertisement
    - neighbor-solicitation
    - neighbor-advertisement
  privacy_extensions:
    enabled: true
    prefer_public: false
