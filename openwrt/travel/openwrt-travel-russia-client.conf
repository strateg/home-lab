# AmneziaWG Client Configuration (GL-AXT1800 → Russia VPS)
# Для получения российского IP адреса (доступ к РФ сервисам из-за границы)
# Файл: /etc/amnezia/amneziawg-russia/awg1.conf

[Interface]
PrivateKey = CLIENT_PRIVATE_KEY_CHANGE_ME
Address = 10.9.1.2/24
DNS = 8.8.8.8, 1.1.1.1

# Обфускация параметры (ДОЛЖНЫ СОВПАДАТЬ с сервером!)
Jc = 7
Jmin = 60
Jmax = 1200
S1 = 40
S2 = 60
H1 = 9876543210
H2 = 1234567890
H3 = 5544332211
H4 = 1122334455

[Peer]
PublicKey = SERVER_PUBLIC_KEY_CHANGE_ME
PresharedKey = PRESHARED_KEY_CHANGE_ME
Endpoint = RUSSIA_VPS_IP:51822
AllowedIPs = 0.0.0.0/0
PersistentKeepalive = 25

# ============================================================
# ИНСТРУКЦИЯ ПО НАСТРОЙКЕ GL-AXT1800
# ============================================================

# 1. Подключиться по SSH к роутеру:
#
# ssh root@192.168.100.1  # в поездке
# или
# ssh root@192.168.20.1   # дома

# 2. Проверить что AmneziaWG уже установлен:
#
# which awg
# awg --version
#
# Если не установлен, см. AMNEZIAWG-SETUP.md для установки

# 3. Создать директорию для Russia VPN:
#
# mkdir -p /etc/amnezia/amneziawg-russia
# cd /etc/amnezia/amneziawg-russia

# 4. Создать ключи клиента:
#
# awg genkey | tee client_privatekey | awg pubkey > client_publickey
#
# echo "Client Private Key:"
# cat client_privatekey
#
# echo "Client Public Key:"
# cat client_publickey
#
# ⚠️ ВАЖНО: Скопируйте Client Public Key!
# Его нужно добавить на сервер в russia-vps-amneziawg.conf

# 5. Скопировать этот конфиг на роутер:
#
# # На компьютере:
# scp openwrt-travel-russia-client.conf root@192.168.100.1:/etc/amnezia/amneziawg-russia/awg1.conf
#
# # На роутере:
# chmod 600 /etc/amnezia/amneziawg-russia/awg1.conf

# 6. Заменить ключи и IP в конфиге:
#
# nano /etc/amnezia/amneziawg-russia/awg1.conf
#
# CLIENT_PRIVATE_KEY_CHANGE_ME = содержимое client_privatekey
# SERVER_PUBLIC_KEY_CHANGE_ME = публичный ключ с Russia VPS сервера
# PRESHARED_KEY_CHANGE_ME = preshared key с Russia VPS сервера
# RUSSIA_VPS_IP = публичный IP вашего российского VPS (например, 5.188.123.45)

# 7. Запустить вручную (для теста):
#
# awg-quick up awg1
#
# # Проверить:
# awg show awg1
# ping 10.9.1.1  # ping сервера
# curl ifconfig.me  # должен показать IP вашего Russia VPS
# curl ipinfo.io  # должен показать Россию

# 8. Остановить:
#
# awg-quick down awg1

# ============================================================
# ИНТЕГРАЦИЯ С /etc/config/network (опционально)
# ============================================================

# Добавить в /etc/config/network:

# config interface 'russiavpn'
#     option proto 'none'
#     option device 'awg1'
#     option auto '0'

# ============================================================
# АВТОЗАПУСК (НЕ РЕКОМЕНДУЕТСЯ)
# ============================================================
#
# Лучше использовать VPN selector скрипт для переключения.
# Но если хотите автозапуск:
#
# cat > /etc/init.d/amneziawg-russia << 'EOF'
# #!/bin/sh /etc/rc.common
# START=99
# STOP=10
#
# start() {
#     awg-quick up awg1
# }
#
# stop() {
#     awg-quick down awg1
# }
#
# restart() {
#     stop
#     sleep 2
#     start
# }
# EOF
#
# chmod +x /etc/init.d/amneziawg-russia
# /etc/init.d/amneziawg-russia enable

# ============================================================
# ROUTING - ВЕСЬ ТРАФИК ЧЕРЕЗ VPN
# ============================================================

# AmneziaWG автоматически создаёт маршруты через AllowedIPs = 0.0.0.0/0
# Проверить маршруты:
#
# ip route show
# ip route show table all

# ============================================================
# DNS ЧЕРЕЗ VPN
# ============================================================

# По умолчанию используется DNS из конфига (8.8.8.8, 1.1.1.1)
# Для использования российских DNS:
#
# Изменить в [Interface]:
# DNS = 77.88.8.8, 77.88.8.1  # Яндекс DNS
# или
# DNS = 8.8.8.8, 1.1.1.1  # Google/Cloudflare (работают везде)

# ============================================================
# FIREWALL
# ============================================================

# Если вы хотите, чтобы трафик шел только через Russia VPN:
#
# Добавить в /etc/config/firewall:

# config zone
#     option name 'russiavpn'
#     option input 'ACCEPT'
#     option output 'ACCEPT'
#     option forward 'REJECT'
#     option masq '1'
#     option mtu_fix '1'
#     list network 'russiavpn'
#
# config forwarding
#     option src 'lan'
#     option dest 'russiavpn'

# /etc/init.d/firewall restart

# ============================================================
# ПРОВЕРКА РАБОТЫ
# ============================================================

# 1. Статус интерфейса:
# awg show awg1
# ip addr show awg1

# 2. Проверка handshake (должен быть недавний):
# awg show awg1 latest-handshakes

# 3. Ping сервера:
# ping -c 5 10.9.1.1

# 4. Проверка внешнего IP (должен быть российский):
# curl ifconfig.me
# curl ipinfo.io
# curl ipinfo.io/country  # должно показать "RU"

# 5. Проверка DNS:
# nslookup google.com

# 6. Проверка маршрутов:
# ip route get 8.8.8.8
# # Должен показать маршрут через awg1

# 7. Traceroute:
# traceroute -n 8.8.8.8
# # Первый hop должен быть 10.9.1.1 (Russia VPS)

# 8. Speedtest:
# curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python3 -

# ============================================================
# СРАВНЕНИЕ С ORACLE CLOUD AMNEZIAWG
# ============================================================

# Oracle Cloud AmneziaWG (openwrt-travel-amneziawg-client.conf):
#   - Интерфейс: awg0
#   - Подсеть: 10.8.2.0/24
#   - Сервер: 10.8.2.1
#   - Порт: 51821
#   - Назначение: Обход DPI блокировок РФ (не-российский IP)
#   - Когда использовать: В России, нужен обход блокировок
#
# Russia VPS AmneziaWG (этот файл):
#   - Интерфейс: awg1
#   - Подсеть: 10.9.1.0/24
#   - Сервер: 10.9.1.1
#   - Порт: 51822
#   - Назначение: Российский IP адрес
#   - Когда использовать: За границей, нужен доступ к РФ сервисам

# ============================================================
# ИСПОЛЬЗОВАНИЕ VPN SELECTOR СКРИПТА
# ============================================================

# Вместо ручного переключения используйте vpn-selector.sh:
#
# # Подключиться к Russia VPS (получить РФ IP)
# /root/vpn-selector.sh russia
#
# # Подключиться к Oracle Cloud (обход блокировок РФ)
# /root/vpn-selector.sh oracle
#
# # Подключиться домой
# /root/vpn-selector.sh home
#
# # Проверить статус
# /root/vpn-selector.sh status

# ============================================================
# TROUBLESHOOTING
# ============================================================

# Проблема: awg команда не найдена
# Решение:
#   which awg
#   opkg list-installed | grep amnezia
#   # Переустановить если нужно

# Проблема: Не могу подключиться к серверу
# Решение:
#   # Проверить доступность сервера
#   ping RUSSIA_VPS_IP
#   # Проверить порт
#   nc -zvu RUSSIA_VPS_IP 51822
#   # Проверить handshake
#   awg show awg1 latest-handshakes

# Проблема: Подключается, но нет интернета
# Решение:
#   # Проверить маршруты
#   ip route show
#   # Проверить DNS
#   cat /etc/resolv.conf
#   nslookup google.com
#   # Проверить что сервер разрешает forwarding

# Проблема: Медленная скорость
# Решение:
#   # Проверить speedtest на самом VPS (без VPN)
#   # Уменьшить обфускацию (в конфиге изменить Jc, Jmax)
#   # Проверить MTU
#   ip link set awg1 mtu 1420

# Проблема: Конфликт с Oracle Cloud AmneziaWG (awg0)
# Решение:
#   # Только ОДИН AmneziaWG может быть активен одновременно
#   # Сначала остановить awg0:
#   awg-quick down awg0
#   # Потом запустить awg1:
#   awg-quick up awg1
#   # Или использовать vpn-selector.sh

# ============================================================
# СЦЕНАРИИ ИСПОЛЬЗОВАНИЯ
# ============================================================

# Сценарий 1: Вы за границей, нужен доступ к Сбербанк онлайн
#   /root/vpn-selector.sh russia
#   # Открыть браузер → online.sberbank.ru
#   # Сбербанк увидит российский IP → разрешит доступ

# Сценарий 2: Вы в России, нужен обход блокировок
#   /root/vpn-selector.sh oracle
#   # Весь трафик через Oracle Cloud (не-РФ IP)

# Сценарий 3: Вы в поездке, нужен доступ к домашнему Proxmox
#   /root/vpn-selector.sh home
#   # Доступ к 192.168.10.0/24, 192.168.20.0/24

# Сценарий 4: Проверить какой VPN активен
#   /root/vpn-selector.sh status
#   curl ifconfig.me

# ============================================================
# ТЕСТИРОВАНИЕ РОССИЙСКОГО IP
# ============================================================

# После подключения к Russia VPS:
#
# # Базовая проверка IP
# curl ifconfig.me
# curl ipinfo.io
#
# # Детальная информация
# curl ipinfo.io/json
#
# # Должно показать:
# {
#   "ip": "5.188.123.45",
#   "hostname": "...",
#   "city": "Moscow" или "Saint Petersburg",
#   "region": "...",
#   "country": "RU",
#   ...
# }
#
# # Проверка через российские сервисы
# curl https://2ip.ru/
# curl https://yandex.ru/internet/  # должен открыться без проблем

# ============================================================
# ДОСТУП К РОССИЙСКИМ СЕРВИСАМ
# ============================================================

# С подключенным Russia VPN вы сможете:
#
# ✅ Сбербанк онлайн, Тинькофф, ВТБ (банки РФ)
# ✅ Госуслуги (gosuslugi.ru)
# ✅ Российские стриминговые сервисы (Okko, Kinopoisk, START)
# ✅ ВКонтакте, Одноклассники (если заблокированы в вашей стране)
# ✅ Yandex сервисы (Яндекс.Музыка, Яндекс.Диск)
# ✅ Российские маркетплейсы (Wildberries, Ozon)
# ✅ Match TV, Первый канал онлайн
#
# Всё что требует российский IP - будет работать!

# ============================================================
# БЕЗОПАСНОСТЬ
# ============================================================

# 1. Не используйте Russia VPN для обхода блокировок В России
#    (Российский IP → российский VPS → DPI видит всё)
#    Для обхода блокировок используйте Oracle Cloud
#
# 2. Регулярно обновлять роутер:
#    opkg update && opkg upgrade
#
# 3. Мониторить подключение:
#    watch -n 5 'awg show awg1'
#
# 4. Backup конфигурации:
#    tar -czf awg-russia-backup.tar.gz /etc/amnezia/amneziawg-russia/

# ============================================================
# ОБНОВЛЕНИЕ AMNEZIAWG
# ============================================================

# Проверять обновления:
# https://github.com/amnezia-vpn/amneziawg-linux-kernel-module/releases
#
# Обновление на GL-AXT1800:
# opkg update
# opkg upgrade amneziawg-tools kmod-amneziawg

# ============================================================
# ПОЛЕЗНЫЕ ССЫЛКИ
# ============================================================

# AmneziaWG GitHub:
# https://github.com/amnezia-vpn/amneziawg-linux-kernel-module
#
# Российские хостинги:
# https://timeweb.com/ (рекомендую)
# https://www.reg.ru/
# https://selectel.ru/
#
# Документация Amnezia VPN:
# https://docs.amnezia.org/
#
# Полное руководство:
# См. RUSSIA-VPS-SETUP.md
