#!/bin/bash
# PostgreSQL Backup Script
# Managed by Ansible

set -euo pipefail

BACKUP_DIR="{{ postgresql_backup_dir }}"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/postgresql_backup_$TIMESTAMP.sql.gz"

# Create backup directory if it doesn't exist
mkdir -p "$BACKUP_DIR"

# Perform backup
pg_dumpall | gzip > "$BACKUP_FILE"

# Set permissions
chmod 600 "$BACKUP_FILE"

echo "Backup completed: $BACKUP_FILE"
