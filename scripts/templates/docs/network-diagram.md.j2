# Network Diagram

**Generated from**: topology.yaml v{{ topology_version }}
**Date**: {{ generated_at }}

---

## Infrastructure Network Topology

```mermaid
graph TB
    %% Trust Zones
    subgraph untrusted["Untrusted Zone"]
        INTERNET[("Internet")]
        {% for network in networks %}
        {% if network.trust_zone_ref == 'untrusted' %}
        {{ network.id | mermaid_id }}["{{ network.name }}<br/>{{ network.cidr }}"]
        {% endif %}
        {% endfor %}
    end

    subgraph user["User Zone"]
        USER_DEVICES[("User Devices")]
        {% for network in networks %}
        {% if network.trust_zone_ref == 'user' %}
        {{ network.id | mermaid_id }}["{{ network.name }}<br/>{{ network.cidr }}"]
        {% endif %}
        {% endfor %}
    end

    subgraph servers["Servers Zone"]
        {% for network in networks %}
        {% if network.trust_zone_ref == 'servers' %}
        {{ network.id | mermaid_id }}["{{ network.name }}<br/>{{ network.cidr }}"]
        {% endif %}
        {% endfor %}

        {% for lxc_item in lxc %}
        {% if lxc_item.trust_zone_ref == 'servers' %}
        {{ lxc_item.id | mermaid_id }}["{{ lxc_item.name }}<br/>{{ lxc_item.type }}"]
        {% endif %}
        {% endfor %}
    end

    subgraph management["Management Zone"]
        {% for network in networks %}
        {% if network.trust_zone_ref == 'management' %}
        {{ network.id | mermaid_id }}["{{ network.name }}<br/>{{ network.cidr }}"]
        {% endif %}
        {% endfor %}
        PROXMOX["Proxmox VE"]
    end

    subgraph guest["Guest/IoT Zones"]
        {% for network in networks %}
        {% if network.trust_zone_ref in ['guest', 'iot'] %}
        {{ network.id | mermaid_id }}["{{ network.name }}<br/>{{ network.cidr }}"]
        {% endif %}
        {% endfor %}
    end

    %% Network bridges
    {% for bridge in bridges %}
    {{ bridge.id | mermaid_id }}[/"{{ bridge.name }}"/]
    {% endfor %}

    %% Core connections
    INTERNET -.-> {{ (networks | selectattr('id', 'equalto', 'net-wan') | map(attribute='id') | first | default('net-wan')) | mermaid_id }}
    USER_DEVICES --> {{ (networks | selectattr('id', 'equalto', 'net-lan') | map(attribute='id') | first | default('net-lan')) | mermaid_id }}

    {% if bridges %}
    {{ (networks | selectattr('id', 'equalto', 'net-lan') | map(attribute='id') | first | default('net-lan')) | mermaid_id }} --> {{ bridges[0].id | mermaid_id }}
    {% endif %}

    {% for lxc_item in lxc %}
    {% for nic in lxc_item.networks %}
    {% if nic.bridge_ref %}
    {{ nic.bridge_ref | mermaid_id }} --> {{ lxc_item.id | mermaid_id }}
    {% endif %}
    {% endfor %}
    {% endfor %}

    PROXMOX --> {{ (networks | selectattr('id', 'equalto', 'net-management') | map(attribute='id') | first | default('net-management')) | mermaid_id }}

    %% Trust zone routing flows
    {{ (networks | selectattr('id', 'equalto', 'net-lan') | map(attribute='id') | first | default('net-lan')) | mermaid_id }} --> {{ (networks | selectattr('id', 'equalto', 'net-servers') | map(attribute='id') | first | default('net-servers')) | mermaid_id }}
    {{ (networks | selectattr('id', 'equalto', 'net-servers') | map(attribute='id') | first | default('net-servers')) | mermaid_id }} --> INTERNET

    %% Styling
    classDef untrusted fill:#ff6b6b,stroke:#c92a2a,color:#fff
    classDef user fill:#74c0fc,stroke:#1864ab,color:#000
    classDef servers fill:#51cf66,stroke:#2b8a3e,color:#000
    classDef management fill:#da77f2,stroke:#9c36b5,color:#fff
    classDef guest fill:#ffd43b,stroke:#fab005,color:#000
    classDef bridge fill:#e9ecef,stroke:#868e96,color:#000
    classDef service fill:#adb5bd,stroke:#495057,color:#000

    class INTERNET untrusted
    {% for network in networks %}
    {% if network.trust_zone_ref == 'untrusted' %}
    class {{ network.id | mermaid_id }} untrusted
    {% elif network.trust_zone_ref == 'user' %}
    class {{ network.id | mermaid_id }} user
    {% elif network.trust_zone_ref == 'servers' %}
    class {{ network.id | mermaid_id }} servers
    {% elif network.trust_zone_ref == 'management' %}
    class {{ network.id | mermaid_id }} management
    {% elif network.trust_zone_ref in ['guest', 'iot'] %}
    class {{ network.id | mermaid_id }} guest
    {% endif %}
    {% endfor %}
    {% for bridge in bridges %}
    class {{ bridge.id | mermaid_id }} bridge
    {% endfor %}
    {% for lxc_item in lxc %}
    class {{ lxc_item.id | mermaid_id }} service
    {% endfor %}
    class PROXMOX management
```

---

## Trust Zones Explanation

| Zone | Level | Purpose | Networks |
|------|-------|---------|----------|
{% for zone_id, zone_config in trust_zones.items() %}
| {{ zone_id | title }} | {{ zone_config.security_level | default('') }} | {{ zone_config.description }} | {% set zone_networks = [] %}{% for network in networks %}{% if network.trust_zone_ref == zone_id %}{% set _ = zone_networks.append(network.name) %}{% endif %}{% endfor %}{{ zone_networks | join(', ') if zone_networks else 'None' }} |
{% endfor %}

---

## Network Details

{% for network in networks %}
### {{ network.name }} ({{ network.id }})

- **CIDR**: {{ network.cidr }}
- **Gateway**: {{ network.gateway | default('N/A') }}
- **Trust Zone**: {{ network.trust_zone_ref }}
- **VLAN**: {{ network.vlan | default('None') }}
- **Managed By**: {{ network.managed_by_ref | default('N/A') }}
{% if network.description %}
- **Description**: {{ network.description }}
{% endif %}

{% if network.ip_allocations %}
**Allocated IPs**:
{% for alloc in network.ip_allocations | sort(attribute='ip') %}
- `{{ alloc.ip }}` -> {{ alloc.device_ref | default(alloc.vm_ref | default(alloc.lxc_ref | default('unknown'))) }} ({{ alloc.interface | default('N/A') }})
{% endfor %}
{% endif %}

---

{% endfor %}

**DO NOT EDIT MANUALLY** - Regenerate with `python3 scripts/generate-docs.py`
