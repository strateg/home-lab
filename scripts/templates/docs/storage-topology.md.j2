# Storage Topology

**Generated from**: topology.yaml v{{ topology_version }}
**Date**: {{ generated_at }}

---

## Storage Architecture

```mermaid
flowchart LR
    subgraph hosts["Hosts"]
        {% for device in devices %}
        {{ device.id | mermaid_id }}["{{ device.name }}"]
        {% endfor %}
    end

    subgraph pools["Storage Pools"]
        {% for pool in storage %}
        {{ pool.id | mermaid_id }}["{{ pool.name }}<br/>{{ pool.type }}{% if pool.path is defined %}<br/>{{ pool.path }}{% endif %}"]
        {% endfor %}
    end

    subgraph assets["Data Assets"]
        {% for asset in data_assets %}
        {{ asset.id | mermaid_id }}["{{ asset.name }}<br/>{{ asset.type }}"]
        {% endfor %}
    end

    {% for pool in storage %}
    {% if pool.device_ref %}
    {{ pool.device_ref | mermaid_id }} --> {{ pool.id | mermaid_id }}
    {% endif %}
    {% endfor %}

    {% for asset in data_assets %}
    {% if asset.storage_ref is defined %}
    {{ asset.storage_ref | mermaid_id }} --> {{ asset.id | mermaid_id }}
    {% elif asset.device_ref is defined %}
    {{ asset.device_ref | mermaid_id }} --> {{ asset.id | mermaid_id }}
    {% endif %}
    {% endfor %}

    classDef host fill:#74c0fc,stroke:#1864ab,color:#000
    classDef pool fill:#51cf66,stroke:#2b8a3e,color:#000
    classDef data fill:#ffd43b,stroke:#fab005,color:#000

    {% for device in devices %}
    class {{ device.id | mermaid_id }} host
    {% endfor %}
    {% for pool in storage %}
    class {{ pool.id | mermaid_id }} pool
    {% endfor %}
    {% for asset in data_assets %}
    class {{ asset.id | mermaid_id }} data
    {% endfor %}
```

---

## Storage Pools

| ID | Name | Type | Device | Content | Shared | Path/VG |
|----|------|------|--------|---------|--------|---------|
{% for pool in storage %}
| {{ pool.id }} | {{ pool.name }} | {{ pool.type }} | {{ pool.device_ref | default('-') }} | {{ pool.content | join(', ') if pool.content else '-' }} | {{ 'Yes' if pool.shared else 'No' }} | {{ pool.path | default(pool.vgname | default('-')) }} |
{% endfor %}

---

## Data Assets

| Asset | Type | Storage Ref | Device Ref | Path |
|-------|------|-------------|------------|------|
{% for asset in data_assets %}
| {{ asset.name }} | {{ asset.type }} | {{ asset.storage_ref | default('-') }} | {{ asset.device_ref | default('-') }} | {{ asset.path | default('-') }} |
{% endfor %}

---

## Backup-Oriented Pools

| Pool | Policies |
|------|----------|
{% for pool in storage %}
{% if pool.prune_backups is defined %}
| {{ pool.name }} | last={{ pool.prune_backups.keep_last | default('-') }}, daily={{ pool.prune_backups.keep_daily | default('-') }}, weekly={{ pool.prune_backups.keep_weekly | default('-') }}, monthly={{ pool.prune_backups.keep_monthly | default('-') }}, yearly={{ pool.prune_backups.keep_yearly | default('-') }} |
{% endif %}
{% endfor %}

---

**DO NOT EDIT MANUALLY** - Regenerate with `python3 scripts/generate-docs.py`
