# =============================================================================
# MikroTik DNS Configuration
# Generated from topology v{{ topology_version }}
# DO NOT EDIT MANUALLY - Regenerate with: python3 scripts/topology/generate-terraform-mikrotik.py
# =============================================================================

# -----------------------------------------------------------------------------
# DNS Settings
# -----------------------------------------------------------------------------
# Note: Primary DNS is handled by AdGuard Home container
# MikroTik forwards to AdGuard container on localhost

resource "routeros_ip_dns" "dns" {
  servers               = ["127.0.0.1"] # AdGuard container
  allow_remote_requests = true
  cache_size            = {{ dns_settings.cache_size_mb | default(2) }}
  cache_max_ttl         = "{{ dns_settings.cache_max_ttl | default('1w') }}"
}

# -----------------------------------------------------------------------------
# Static DNS Records
# -----------------------------------------------------------------------------

{% for record in dns_records %}
{% if record.type == 'A' %}
resource "routeros_ip_dns_record" "{{ record.name | replace('.', '_') | replace('-', '_') }}" {
  name    = "{{ record.name }}.{{ dns_domain }}"
  address = "{{ record.ip }}"
  type    = "A"
  ttl     = "{{ record.ttl | default('1d') }}"
  comment = "{{ record.description | default('') }}"
}

{% elif record.type == 'CNAME' %}
resource "routeros_ip_dns_record" "{{ record.name | replace('.', '_') | replace('-', '_') }}_cname" {
  name    = "{{ record.name }}.{{ dns_domain }}"
  cname   = "{{ record.target }}"
  type    = "CNAME"
  ttl     = "{{ record.ttl | default('1d') }}"
  comment = "{{ record.description | default('') }}"
}

{% endif %}
{% endfor %}
