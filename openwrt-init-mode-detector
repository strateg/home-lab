#!/bin/sh /etc/rc.common
# OpenWRT Init Script - Mode Auto-Detection
# Place in: /etc/init.d/mode-detector
# Enable: /etc/init.d/mode-detector enable
# Start priority: 99 (late start, after network)

START=99
STOP=10

USE_PROCD=1

start_service() {
    # Run mode switcher on boot
    /usr/bin/openwrt-mode-switcher.sh

    # Start procd service for continuous monitoring
    procd_open_instance
    procd_set_param command /bin/sh -c "while true; do sleep 300; /usr/bin/openwrt-mode-switcher.sh; done"
    procd_set_param respawn 3600 5 0
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
}

stop_service() {
    logger -t mode-detector "Stopping mode detector service"
}

restart() {
    stop
    sleep 2
    start
}
