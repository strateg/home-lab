{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Home Lab Topology v4.0 - Layered (Enhanced)",
  "description": "Infrastructure-as-Data schema with strict type validation",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "L0_meta",
    "L1_foundation",
    "L2_network",
    "L3_data",
    "L4_platform",
    "L5_application",
    "L6_observability",
    "L7_operations"
  ],

  "definitions": {
    "DeviceType": {
      "type": "string",
      "enum": ["hypervisor", "router", "sbc", "switch", "ap", "nas", "cloud-vm", "ups", "pdu"]
    },
    "DeviceRole": {
      "type": "string",
      "enum": ["compute", "central-gateway", "application-server", "travel-router", "storage-server", "backup-server", "cloud-server", "vpn-exit-node", "power-backup", "power-distribution"]
    },
    "DeviceClass": {
      "type": "string",
      "enum": ["network", "compute", "storage", "power", "external"]
    },
    "DeviceSubstrate": {
      "type": "string",
      "enum": ["baremetal-owned", "baremetal-colo", "provider-instance"]
    },
    "DeviceAccess": {
      "type": "string",
      "enum": ["local-lan", "vpn-only", "public"]
    },
    "PowerSourceType": {
      "type": "string",
      "enum": ["ac-mains", "dc-adapter", "usb-pd", "poe", "battery", "ups-output", "cloud-provider"]
    },
    "PowerDeliveryStandard": {
      "type": "string",
      "enum": ["802.3af", "802.3at", "802.3bt", "usb-pd-3.0", "usb-pd-3.1", "proprietary"]
    },
    "InterfaceType": {
      "type": "string",
      "enum": ["ethernet", "pci-ethernet", "usb-ethernet", "wifi-5ghz", "wifi-2.4ghz", "lte", "usb", "usb-c", "hdmi", "display", "camera", "expansion", "audio", "debug"]
    },
    "InterfaceRole": {
      "type": "string",
      "enum": ["wan", "wan-failover", "lan", "reserved", "trunk", "management", "power + data + display"]
    },
    "LocationType": {
      "type": "string",
      "enum": ["home-office", "mobile", "datacenter", "remote", "portable", "cloud"]
    },
    "CloudProvider": {
      "type": "string",
      "enum": ["oracle", "hetzner", "aws", "gcp", "azure", "digitalocean", "vultr", "linode"]
    },
    "CloudRegion": {
      "type": "string",
      "description": "Cloud provider region/datacenter identifier",
      "examples": ["eu-frankfurt-1", "fsn1", "eu-central-1", "europe-west1"]
    },
    "TrustZone": {
      "type": "string",
      "enum": ["untrusted", "guest", "user", "iot", "servers", "management"]
    },
    "SecurityLevel": {
      "type": "integer",
      "minimum": 0,
      "maximum": 3
    },
    "TrustZoneDefinition": {
      "type": "object",
      "required": ["name", "security_level"],
      "properties": {
        "name": { "type": "string" },
        "security_level": { "$ref": "#/definitions/SecurityLevel" },
        "color": { "type": "string", "pattern": "^#[0-9A-Fa-f]{6}$" },
        "description": { "type": "string" },
        "isolated": { "type": "boolean" },
        "allowed_outbound": {
          "type": "array",
          "items": { "type": "string" }
        },
        "allowed_inbound": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    },
    "VpnType": {
      "type": "string",
      "enum": ["wireguard", "tailscale", "openvpn", "ipsec", "zerotier"]
    },
    "PhysicalLinkMedium": {
      "type": "string",
      "enum": ["ethernet", "wifi", "fiber", "optical", "lte", "coax", "usb", "serial"]
    },
    "PowerLinkMode": {
      "type": "string",
      "enum": ["ac", "dc", "poe", "usb-pd", "battery", "wireless-inductive"]
    },
    "NetworkPlane": {
      "type": "string",
      "enum": ["virtual", "underlay-uplink", "overlay"]
    },
    "SegmentationType": {
      "type": "string",
      "enum": ["uplink", "routed-subnet", "vlan", "bridge", "overlay-vpn", "mesh-overlay"]
    },
    "NetworkTransport": {
      "type": "string",
      "enum": ["ethernet", "wifi", "fiber", "lte", "internet-overlay"]
    },
    "NetworkVolatility": {
      "type": "string",
      "enum": ["low", "medium", "high"]
    },
    "NetworkProfileRef": {
      "type": "string",
      "pattern": "^prof-[a-z0-9-]+$"
    },
    "FirewallAction": {
      "type": "string",
      "enum": ["accept", "drop", "reject", "log", "pass"]
    },
    "FirewallChain": {
      "type": "string",
      "enum": ["input", "output", "forward", "prerouting", "postrouting"]
    },
    "ConnectionState": {
      "type": "string",
      "enum": ["new", "established", "related", "invalid"]
    },
    "DscpMark": {
      "type": "string",
      "enum": ["ef", "af41", "af31", "af21", "af11", "be", "cs1", "cs0", "cs2", "cs3", "cs4", "cs5", "cs6", "cs7"]
    },
    "NetworkProtocol": {
      "type": "string",
      "enum": ["tcp", "udp", "icmp", "icmpv6", "any"]
    },
    "StorageType": {
      "type": "string",
      "enum": ["dir", "lvmthin", "lvm", "zfs", "nfs", "cifs", "cephfs", "rbd"]
    },
    "StorageContent": {
      "type": "string",
      "enum": ["images", "rootdir", "vztmpl", "iso", "backup", "snippets"]
    },
    "DiskType": {
      "type": "string",
      "enum": ["hdd", "ssd", "nvme", "sd-card", "emmc", "flash"]
    },
    "DiskState": {
      "type": "string",
      "enum": ["present", "planned", "optional", "retired"]
    },
    "StoragePortType": {
      "type": "string",
      "enum": ["ide", "sata", "sas", "m2", "pcie", "usb", "sdio", "emmc", "emmc-reader", "qspi", "onboard", "virtual"]
    },
    "StorageMountType": {
      "type": "string",
      "enum": ["soldered", "replaceable", "removable", "virtual"]
    },
    "StorageMedia": {
      "type": "object",
      "required": ["id", "type", "size_gb"],
      "properties": {
        "id": { "$ref": "#/definitions/MediaRef" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/DiskType" },
        "form_factor": {
          "type": "string",
          "enum": ["3.5in", "2.5in", "m2-2280", "m2-2242", "msata", "microsd", "sd", "usb-stick", "usb-ssd", "onboard-chip", "virtual", "other"]
        },
        "supported_buses": {
          "type": "array",
          "items": { "$ref": "#/definitions/StoragePortType" }
        },
        "state": { "$ref": "#/definitions/DiskState" },
        "size_gb": { "type": "number", "minimum": 0.001 },
        "serial": { "type": "string" },
        "vendor": { "type": "string" },
        "model": { "type": "string" },
        "usage": { "type": "string" },
        "boot": { "type": "boolean" },
        "removable": { "type": "boolean" },
        "rotational": { "type": "boolean" },
        "virtual": { "type": "boolean" },
        "description": { "type": "string" }
      },
      "additionalProperties": false
    },
    "StorageSlot": {
      "type": "object",
      "required": ["id", "bus", "mount"],
      "properties": {
        "id": { "type": "string", "pattern": "^slot-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "bus": { "$ref": "#/definitions/StoragePortType" },
        "mount": { "$ref": "#/definitions/StorageMountType" },
        "connector": { "type": "string" },
        "max_speed_gbps": { "type": "number", "minimum": 0 },
        "lanes": { "type": "integer", "minimum": 1 },
        "description": { "type": "string" }
      },
      "additionalProperties": false
    },
    "StorageMediaAttachment": {
      "type": "object",
      "required": ["id", "device_ref", "slot_ref", "media_ref"],
      "properties": {
        "id": { "type": "string", "pattern": "^attach-[a-z0-9-]+$" },
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "slot_ref": { "type": "string", "pattern": "^slot-[a-z0-9-]+$" },
        "media_ref": { "$ref": "#/definitions/MediaRef" },
        "state": { "$ref": "#/definitions/DiskState" },
        "description": { "type": "string" }
      },
      "additionalProperties": false
    },
    "DeviceSpecs": {
      "type": "object",
      "properties": {
        "storage_slots": {
          "type": "array",
          "description": "Slot capabilities model: each slot describes bus, mount type and connector characteristics",
          "items": { "$ref": "#/definitions/StorageSlot" }
        }
      },
      "additionalProperties": true
    },
    "DataAssetType": {
      "type": "string",
      "enum": ["config-export", "database", "cache", "backup-artifact", "volume", "file", "media"]
    },
    "DataAssetCategory": {
      "type": "string",
      "enum": [
        "database",
        "cache",
        "timeseries",
        "search-index",
        "object-storage",
        "file-share",
        "media-library",
        "configuration",
        "secrets",
        "logs"
      ]
    },
    "DataCriticality": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"]
    },
    "LxcType": {
      "type": "string",
      "enum": ["database", "cache", "web", "application", "utility", "proxy"]
    },
    "LxcRole": {
      "type": "string",
      "enum": ["database-server", "cache-server", "web-server", "app-server", "proxy-server"]
    },
    "PlatformType": {
      "type": "string",
      "enum": ["lxc-unprivileged", "lxc-privileged", "lxc-nested", "vm-uefi", "vm-bios", "vm-cloud-init"]
    },
    "TemplateSource": {
      "type": "string",
      "enum": ["proxmox", "proxmox-community-scripts", "cloud-init", "manual", "turnkey"]
    },
    "OsType": {
      "type": "string",
      "enum": ["debian", "ubuntu", "alpine", "centos", "rocky", "fedora", "openwrt", "routeros"]
    },
    "ServiceType": {
      "type": "string",
      "enum": ["web-ui", "web-application", "dns", "vpn", "database", "cache", "media-server", "monitoring", "alerting", "logging", "visualization", "home-automation", "file-storage", "proxy", "mail"]
    },
    "ContainerRuntime": {
      "type": "string",
      "enum": ["docker", "podman", "lxc", "native", "containerd"]
    },
    "RuntimeType": {
      "type": "string",
      "enum": ["lxc", "vm", "docker", "baremetal"]
    },
    "CertificateType": {
      "type": "string",
      "enum": ["self-signed", "letsencrypt", "local-ca"]
    },
    "ChallengeType": {
      "type": "string",
      "enum": ["http-01", "dns-01"]
    },
    "DnsRecordType": {
      "type": "string",
      "enum": ["A", "AAAA", "CNAME", "MX", "TXT", "SRV", "PTR", "NS", "CAA"]
    },
    "DnsZoneType": {
      "type": "string",
      "enum": ["forward", "reverse", "stub"]
    },
    "HealthCheckType": {
      "type": "string",
      "enum": [
        "ping", "port", "http", "https", "tcp", "snmp", "api",
        "cpu_usage", "memory_usage", "disk_usage", "load_average",
        "temperature", "service", "process", "docker", "docker_container",
        "lxc_status", "query", "redis_ping", "redis_memory", "redis_keys",
        "ups_status", "battery_charge", "battery_runtime", "load", "input_voltage",
        "interface_status", "lte_signal", "failover_status", "sim_status",
        "dns", "traceroute", "connection_count", "replication_lag"
      ]
    },
    "AlertSeverity": {
      "type": "string",
      "enum": ["info", "warning", "critical"]
    },
    "NotificationChannelType": {
      "type": "string",
      "enum": ["email", "telegram", "slack", "webhook", "sms", "pushover"]
    },
    "BackupType": {
      "type": "string",
      "enum": ["vzdump", "pg_dump", "rsync", "rclone", "config-export", "tar", "borg"]
    },
    "BackupCompression": {
      "type": "string",
      "enum": ["none", "gzip", "zstd", "lz4", "xz"]
    },
    "BackupMode": {
      "type": "string",
      "enum": ["snapshot", "stop", "suspend"]
    },
    "StorageMediaType": {
      "type": "string",
      "enum": ["ssd", "hdd", "nvme", "cloud", "tape"]
    },
    "SshKeyType": {
      "type": "string",
      "enum": ["ed25519", "rsa", "ecdsa"]
    },

    "IdPattern": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9-]*$",
      "minLength": 2,
      "maxLength": 64
    },
    "DeviceRef": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9-]*$"
    },
    "NetworkRef": {
      "type": "string",
      "pattern": "^net-[a-z0-9-]+$"
    },
    "BridgeRef": {
      "type": "string",
      "pattern": "^bridge-[a-z0-9]+$"
    },
    "StorageRef": {
      "type": "string",
      "pattern": "^storage-[a-z0-9-]+$"
    },
    "StorageEndpointRef": {
      "type": "string",
      "pattern": "^se-[a-z0-9-]+$"
    },
    "MediaRef": {
      "type": "string",
      "pattern": "^disk-[a-z0-9-]+$"
    },
    "DataAssetRef": {
      "type": "string",
      "pattern": "^data-[a-z0-9-]+$"
    },
    "LxcRef": {
      "type": "string",
      "pattern": "^lxc-[a-z0-9-]+$"
    },
    "VmRef": {
      "type": "string",
      "pattern": "^vm-[a-z0-9-]+$"
    },
    "ServiceRef": {
      "type": "string",
      "pattern": "^svc-[a-z0-9-]+$"
    },
    "ResourceProfileRef": {
      "type": "string",
      "pattern": "^profile-[a-z0-9-]+$"
    },
    "BackupPolicyRef": {
      "type": "string",
      "pattern": "^backup-[a-z0-9-]+$"
    },
    "SecurityPolicyRef": {
      "type": "string",
      "pattern": "^sec-[a-z0-9-]+$"
    },
    "InterfaceRef": {
      "type": "string",
      "pattern": "^if-[a-z0-9-]+$"
    },
    "DataLinkRef": {
      "type": "string",
      "pattern": "^link-[a-z0-9-]+$"
    },
    "FirewallPolicyRef": {
      "type": "string",
      "pattern": "^fw-[a-z0-9-]+$"
    },

    "IpAddress": {
      "type": "string",
      "pattern": "^(\\d{1,3}\\.){3}\\d{1,3}$"
    },
    "IpAddressWithCidr": {
      "type": "string",
      "pattern": "^(\\d{1,3}\\.){3}\\d{1,3}/\\d{1,2}$"
    },
    "Cidr": {
      "type": "string",
      "oneOf": [
        { "pattern": "^(\\d{1,3}\\.){3}\\d{1,3}/\\d{1,2}$" },
        { "enum": ["dhcp"] }
      ]
    },
    "Port": {
      "type": "integer",
      "minimum": 1,
      "maximum": 65535
    },
    "MacAddress": {
      "type": "string",
      "pattern": "^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$|^auto-detect$"
    },
    "Percentage": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100
    },
    "Duration": {
      "type": "string",
      "pattern": "^\\d+[smhd]$"
    },
    "CronSchedule": {
      "type": "string",
      "pattern": "^[0-9*,/-]+ [0-9*,/-]+ [0-9*,/-]+ [0-9*,/-]+ [0-9*,/-]+$"
    },

    "Device": {
      "type": "object",
      "required": ["id", "name", "type", "role", "class", "substrate", "access"],
      "properties": {
        "id": { "$ref": "#/definitions/IdPattern" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/DeviceType" },
        "role": { "$ref": "#/definitions/DeviceRole" },
        "class": { "$ref": "#/definitions/DeviceClass" },
        "substrate": { "$ref": "#/definitions/DeviceSubstrate" },
        "access": { "$ref": "#/definitions/DeviceAccess" },
        "model": { "type": "string" },
        "location": { "type": "string" },
        "description": { "type": "string" },
        "supported_operating_systems": {
          "type": "array",
          "items": { "type": "string" }
        },
        "specs": { "$ref": "#/definitions/DeviceSpecs" },
        "interfaces": {
          "type": "array",
          "items": { "$ref": "#/definitions/Interface" }
        },
        "power": { "$ref": "#/definitions/DevicePower" },
        "firmware": { "type": "object" },
        "cloud": { "$ref": "#/definitions/CloudConfig" }
      }
    },
    "DevicePower": {
      "type": "object",
      "properties": {
        "primary_source": { "$ref": "#/definitions/PowerSourceType" },
        "backup_source": { "$ref": "#/definitions/PowerSourceType" },
        "upstream_power_ref": { "type": "string", "pattern": "^(ups|pdu)-[a-z0-9-]+$" },
        "connector": { "type": "string" },
        "input_voltage": { "type": "string" },
        "input_voltage_v": { "type": "number" },
        "input_current_a": { "type": "number" },
        "max_watts": { "type": "number" },
        "typical_watts": { "type": "number" },
        "psu": { "type": "string" },
        "battery_present": { "type": "boolean" },
        "battery_chemistry": { "type": "string" },
        "poe": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "role": { "type": "string", "enum": ["pd", "pse", "passthrough"] },
            "standard": { "$ref": "#/definitions/PowerDeliveryStandard" },
            "class": { "type": "integer", "minimum": 0, "maximum": 8 },
            "max_watts": { "type": "number" }
          }
        }
      },
      "additionalProperties": true
    },
    "CloudConfig": {
      "type": "object",
      "description": "Cloud-specific configuration for cloud-vm devices",
      "required": ["provider", "region"],
      "properties": {
        "provider": { "$ref": "#/definitions/CloudProvider" },
        "region": { "type": "string" },
        "availability_zone": { "type": "string" },
        "instance_type": { "type": "string" },
        "vcpus": { "type": "integer", "minimum": 1 },
        "memory_gb": { "type": "number", "minimum": 0.5 },
        "boot_volume_gb": { "type": "integer", "minimum": 10 },
        "public_ip": { "type": "boolean" },
        "ipv6": { "type": "boolean" },
        "vpc_id": { "type": "string" },
        "subnet_id": { "type": "string" },
        "security_groups": { "type": "array", "items": { "type": "string" } },
        "ssh_key_name": { "type": "string" },
        "pricing": {
          "type": "object",
          "properties": {
            "tier": { "type": "string", "enum": ["free", "paid"] },
            "monthly_cost": { "type": "number" },
            "currency": { "type": "string", "default": "EUR" }
          }
        },
        "tags": { "type": "object" }
      }
    },
    "Interface": {
      "type": "object",
      "required": ["id", "name", "type"],
      "properties": {
        "id": { "$ref": "#/definitions/InterfaceRef" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/InterfaceType" },
        "speed_mbps": { "type": "integer" },
        "mac": { "$ref": "#/definitions/MacAddress" },
        "role": { "$ref": "#/definitions/InterfaceRole" },
        "description": { "type": "string" }
      }
    },
    "Location": {
      "type": "object",
      "required": ["id", "name", "type"],
      "properties": {
        "id": { "$ref": "#/definitions/IdPattern" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/LocationType" },
        "description": { "type": "string" },
        "provider": { "$ref": "#/definitions/CloudProvider" },
        "region": { "type": "string" }
      }
    },
    "PhysicalLinkEndpoint": {
      "type": "object",
      "properties": {
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "interface_ref": { "$ref": "#/definitions/InterfaceRef" },
        "external_ref": { "type": "string" },
        "description": { "type": "string" }
      },
      "anyOf": [
        { "required": ["device_ref"] },
        { "required": ["external_ref"] }
      ]
    },
    "PhysicalLink": {
      "type": "object",
      "required": ["id", "endpoint_a", "endpoint_b", "medium"],
      "properties": {
        "id": { "type": "string", "pattern": "^link-[a-z0-9-]+$" },
        "endpoint_a": { "$ref": "#/definitions/PhysicalLinkEndpoint" },
        "endpoint_b": { "$ref": "#/definitions/PhysicalLinkEndpoint" },
        "medium": { "$ref": "#/definitions/PhysicalLinkMedium" },
        "speed_mbps": { "type": "integer", "minimum": 1 },
        "duplex": { "type": "string", "enum": ["half", "full"] },
        "vlan_trunk": { "type": "boolean" },
        "power_delivery": { "$ref": "#/definitions/PowerDelivery" },
        "status": { "type": "string", "enum": ["active", "standby", "planned"] },
        "description": { "type": "string" }
      }
    },
    "PowerDelivery": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "mode": { "type": "string", "enum": ["poe"] },
        "standard": { "$ref": "#/definitions/PowerDeliveryStandard" },
        "provider_endpoint": { "type": "string", "enum": ["endpoint_a", "endpoint_b", "external"] },
        "class": { "type": "integer", "minimum": 0, "maximum": 8 },
        "max_watts": { "type": "number" },
        "voltage_v": { "type": "number" },
        "description": { "type": "string" }
      }
    },
    "PowerLink": {
      "type": "object",
      "required": ["id", "endpoint_a", "endpoint_b", "mode"],
      "properties": {
        "id": { "type": "string", "pattern": "^plink-[a-z0-9-]+$" },
        "endpoint_a": { "$ref": "#/definitions/PhysicalLinkEndpoint" },
        "endpoint_b": { "$ref": "#/definitions/PhysicalLinkEndpoint" },
        "mode": { "$ref": "#/definitions/PowerLinkMode" },
        "standard": { "$ref": "#/definitions/PowerDeliveryStandard" },
        "provider_endpoint": { "type": "string", "enum": ["endpoint_a", "endpoint_b", "external"] },
        "max_watts": { "type": "number", "minimum": 0 },
        "voltage_v": { "type": "number", "minimum": 0 },
        "current_a": { "type": "number", "minimum": 0 },
        "data_link_ref": { "$ref": "#/definitions/DataLinkRef" },
        "status": { "type": "string", "enum": ["active", "standby", "planned"] },
        "description": { "type": "string" }
      }
    },
    "PowerPolicy": {
      "type": "object",
      "required": ["id", "name", "type", "device_ref"],
      "properties": {
        "id": { "type": "string", "pattern": "^policy-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "policy_scope": { "type": "string", "enum": ["ups", "pdu", "mixed"] },
        "model": { "type": "string" },
        "type": { "type": "string", "enum": ["ups-protection", "pdu-distribution", "outage-propagation"] },
        "ups_type": { "type": "string", "enum": ["line-interactive", "online-double-conversion", "offline-standby", "dc-ups"] },
        "location": { "type": "string" },
        "description": { "type": "string" },
        "specs": { "type": "object" },
        "connection": { "type": "object" },
        "protected_devices": { "type": "array" },
        "outage_model": { "type": "object" },
        "thresholds": { "type": "object" },
        "actions": { "type": "object" },
        "monitoring": { "type": "object" },
        "notifications": { "type": "object" }
      },
      "additionalProperties": true
    },
    "FirewallPolicy": {
      "type": "object",
      "required": ["id", "action", "chain"],
      "properties": {
        "id": { "$ref": "#/definitions/FirewallPolicyRef" },
        "name": { "type": "string" },
        "priority": { "type": "integer", "minimum": 0 },
        "source_zone_ref": { "$ref": "#/definitions/TrustZone" },
        "source_network_ref": { "$ref": "#/definitions/NetworkRef" },
        "destination_zone_ref": { "$ref": "#/definitions/TrustZone" },
        "destination_zones_ref": {
          "type": "array",
          "items": { "$ref": "#/definitions/TrustZone" }
        },
        "destination_network_ref": { "$ref": "#/definitions/NetworkRef" },
        "ports": {
          "type": "array",
          "items": { "$ref": "#/definitions/Port" }
        },
        "protocols": {
          "type": "array",
          "items": { "$ref": "#/definitions/NetworkProtocol" }
        },
        "action": { "$ref": "#/definitions/FirewallAction" },
        "chain": { "$ref": "#/definitions/FirewallChain" },
        "connection_state": {
          "type": "array",
          "items": { "$ref": "#/definitions/ConnectionState" }
        },
        "description": { "type": "string" },
        "security_policy_ref": { "$ref": "#/definitions/SecurityPolicyRef" }
      },
      "additionalProperties": false
    },
    "Network": {
      "type": "object",
      "required": ["id", "name", "cidr"],
      "properties": {
        "id": { "$ref": "#/definitions/NetworkRef" },
        "name": { "type": "string" },
        "cidr": { "$ref": "#/definitions/Cidr" },
        "gateway": { "oneOf": [{ "type": "string" }, { "type": "null" }] },
        "dns": { "type": "array", "items": { "$ref": "#/definitions/IpAddress" } },
        "dhcp": { "type": "boolean" },
        "dhcp_range": { "type": "string" },
        "trust_zone_ref": { "$ref": "#/definitions/TrustZone" },
        "bridge_ref": { "oneOf": [{ "$ref": "#/definitions/BridgeRef" }, { "type": "null" }] },
        "vlan": { "oneOf": [{ "type": "integer", "minimum": 1, "maximum": 4094 }, { "type": "null" }] },
        "description": { "type": "string" },
        "profile_ref": { "$ref": "#/definitions/NetworkProfileRef" },
        "network_plane": { "$ref": "#/definitions/NetworkPlane" },
        "segmentation_type": { "$ref": "#/definitions/SegmentationType" },
        "transport": {
          "type": "array",
          "items": { "$ref": "#/definitions/NetworkTransport" }
        },
        "volatility": { "$ref": "#/definitions/NetworkVolatility" },
        "managed_by_ref": { "$ref": "#/definitions/DeviceRef" },
        "interface_ref": { "$ref": "#/definitions/InterfaceRef" },
        "vpn_type": { "$ref": "#/definitions/VpnType" },
        "ip_allocations": { "type": "array" },
        "firewall_policy_refs": {
          "type": "array",
          "items": { "$ref": "#/definitions/FirewallPolicyRef" },
          "description": "List of firewall policy IDs that apply to this network"
        }
      }
    },
    "NetworkProfile": {
      "type": "object",
      "required": ["network_plane", "segmentation_type", "transport", "volatility"],
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "network_plane": { "$ref": "#/definitions/NetworkPlane" },
        "segmentation_type": { "$ref": "#/definitions/SegmentationType" },
        "transport": {
          "type": "array",
          "items": { "$ref": "#/definitions/NetworkTransport" }
        },
        "volatility": { "$ref": "#/definitions/NetworkVolatility" }
      }
    },
    "Bridge": {
      "type": "object",
      "required": ["id", "device_ref", "name"],
      "properties": {
        "id": { "$ref": "#/definitions/BridgeRef" },
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "name": { "type": "string" },
        "comment": { "type": "string" },
        "ports": { "type": "array", "items": { "type": "string" } },
        "address": { "$ref": "#/definitions/IpAddressWithCidr" },
        "gateway": { "$ref": "#/definitions/IpAddress" },
        "network_ref": { "$ref": "#/definitions/NetworkRef" },
        "vlan_aware": { "type": "boolean" },
        "bridge_stp": { "type": "boolean" },
        "bridge_fd": { "type": "integer" }
      }
    },
    "Storage": {
      "type": "object",
      "required": ["id", "name", "type"],
      "properties": {
        "id": { "$ref": "#/definitions/StorageRef" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/StorageType" },
        "path": { "type": "string" },
        "os_device": { "type": "string", "pattern": "^/dev/.+" },
        "content": {
          "type": "array",
          "items": { "$ref": "#/definitions/StorageContent" }
        },
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "disk_ref": { "$ref": "#/definitions/MediaRef" },
        "shared": { "type": "boolean" },
        "description": { "type": "string" }
      }
    },
    "Partition": {
      "type": "object",
      "required": ["id", "media_attachment_ref", "number", "type"],
      "properties": {
        "id": { "type": "string", "pattern": "^part-[a-z0-9-]+$" },
        "media_attachment_ref": { "type": "string", "pattern": "^attach-[a-z0-9-]+$" },
        "number": { "type": "integer", "minimum": 1 },
        "type": { "type": "string", "enum": ["efi", "swap", "ext4", "xfs", "zfs", "lvm-pv", "other"] },
        "size": {
          "oneOf": [
            { "type": "number", "minimum": 0.001 },
            { "type": "string", "enum": ["remaining"] }
          ]
        },
        "flags": { "type": "array", "items": { "type": "string" } },
        "description": { "type": "string" }
      }
    },
    "VolumeGroup": {
      "type": "object",
      "required": ["id", "name", "type", "pv_refs"],
      "properties": {
        "id": { "type": "string", "pattern": "^vg-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "type": { "type": "string", "enum": ["lvm", "zfs", "btrfs"] },
        "pv_refs": { "type": "array", "items": { "type": "string", "pattern": "^part-[a-z0-9-]+$" } },
        "description": { "type": "string" }
      }
    },
    "LogicalVolume": {
      "type": "object",
      "required": ["id", "name", "type", "vg_ref"],
      "properties": {
        "id": { "type": "string", "pattern": "^lv-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "type": { "type": "string", "enum": ["thin-pool", "thick", "dataset", "zvol", "filesystem"] },
        "vg_ref": { "type": "string", "pattern": "^vg-[a-z0-9-]+$" },
        "size_gb": { "type": "number", "minimum": 0.001 },
        "description": { "type": "string" }
      }
    },
    "Filesystem": {
      "type": "object",
      "required": ["id", "type"],
      "properties": {
        "id": { "type": "string", "pattern": "^fs-[a-z0-9-]+$" },
        "type": { "type": "string", "enum": ["ext4", "xfs", "zfs", "btrfs"] },
        "lv_ref": { "type": "string", "pattern": "^lv-[a-z0-9-]+$" },
        "partition_ref": { "type": "string", "pattern": "^part-[a-z0-9-]+$" },
        "mount_options": { "type": "array", "items": { "type": "string" } },
        "description": { "type": "string" }
      }
    },
    "MountPoint": {
      "type": "object",
      "required": ["id", "path"],
      "properties": {
        "id": { "type": "string", "pattern": "^mnt-[a-z0-9-]+$" },
        "path": { "type": "string", "pattern": "^/.*" },
        "filesystem_ref": { "type": "string", "pattern": "^fs-[a-z0-9-]+$" },
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "description": { "type": "string" }
      }
    },
    "StorageEndpoint": {
      "type": "object",
      "required": ["id", "name", "platform", "type"],
      "properties": {
        "id": { "$ref": "#/definitions/StorageEndpointRef" },
        "name": { "type": "string" },
        "platform": { "type": "string", "enum": ["proxmox", "docker", "kubernetes", "host"] },
        "type": { "$ref": "#/definitions/StorageType" },
        "lv_ref": { "type": "string", "pattern": "^lv-[a-z0-9-]+$" },
        "mount_point_ref": { "type": "string", "pattern": "^mnt-[a-z0-9-]+$" },
        "infer_from": {
          "type": "object",
          "description": "Shorthand: derives partition/VG/LV/FS/mount chain automatically",
          "properties": {
            "media_attachment_ref": { "type": "string", "pattern": "^attach-[a-z0-9-]+$" },
            "vg_name": { "type": "string" },
            "lv_name": { "type": "string" },
            "auto_chain": { "type": "boolean" }
          },
          "additionalProperties": false,
          "allOf": [
            {
              "if": { "required": ["lv_name"] },
              "then": { "required": ["vg_name"] }
            }
          ]
        },
        "content": {
          "type": "array",
          "items": { "$ref": "#/definitions/StorageContent" }
        },
        "path": { "type": "string" },
        "shared": { "type": "boolean" },
        "description": { "type": "string" }
      },
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "lvmthin" } },
            "required": ["type", "infer_from"]
          },
          "then": {
            "properties": {
              "infer_from": {
                "required": ["media_attachment_ref", "vg_name", "lv_name"]
              }
            }
          }
        }
      ]
    },
    "ResourceProfile": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": { "$ref": "#/definitions/ResourceProfileRef" },
        "name": { "type": "string" },
        "cpu": {
          "type": "object",
          "properties": {
            "cores": { "type": "integer", "minimum": 1 },
            "limit_percent": { "$ref": "#/definitions/Percentage" }
          }
        },
        "memory": {
          "type": "object",
          "properties": {
            "mb": { "type": "integer", "minimum": 64 },
            "swap_mb": { "type": "integer", "minimum": 0 }
          }
        },
        "storage": {
          "type": "object",
          "properties": {
            "rootfs_gb": { "type": "number", "minimum": 0.1 }
          }
        },
        "tuning": { "type": "object" },
        "description": { "type": "string" }
      }
    },
    "LxcStorageRootfs": {
      "type": "object",
      "properties": {
        "storage_ref": { "$ref": "#/definitions/StorageRef" },
        "storage_endpoint_ref": { "$ref": "#/definitions/StorageEndpointRef" },
        "size_gb": { "type": "number", "minimum": 0.1 }
      }
    },
    "LxcVolume": {
      "type": "object",
      "required": ["id", "mount_path"],
      "properties": {
        "id": { "type": "string", "pattern": "^vol-[a-z0-9-]+$" },
        "mount_path": { "type": "string", "pattern": "^/.+" },
        "storage_ref": { "$ref": "#/definitions/StorageRef" },
        "storage_endpoint_ref": { "$ref": "#/definitions/StorageEndpointRef" },
        "size_gb": { "type": "number", "minimum": 0.1 },
        "data_asset_ref": { "$ref": "#/definitions/DataAssetRef" },
        "backup": { "type": "boolean" }
      }
    },
    "LxcStorage": {
      "type": "object",
      "properties": {
        "rootfs": { "$ref": "#/definitions/LxcStorageRootfs" },
        "volumes": {
          "type": "array",
          "items": { "$ref": "#/definitions/LxcVolume" }
        }
      }
    },
    "ServiceEndpoint": {
      "type": "object",
      "required": ["name", "protocol", "port"],
      "properties": {
        "name": { "type": "string" },
        "protocol": { "type": "string", "enum": ["http", "https", "tcp", "udp"] },
        "port": { "$ref": "#/definitions/Port" }
      }
    },
    "ServiceRuntime": {
      "type": "object",
      "required": ["type", "target_ref"],
      "properties": {
        "type": { "$ref": "#/definitions/RuntimeType" },
        "target_ref": { "$ref": "#/definitions/IdPattern" },
        "network_binding_ref": { "$ref": "#/definitions/NetworkRef" },
        "image": { "type": "string" }
      },
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "lxc" } },
            "required": ["type"]
          },
          "then": {
            "properties": {
              "target_ref": { "$ref": "#/definitions/LxcRef" }
            }
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "vm" } },
            "required": ["type"]
          },
          "then": {
            "properties": {
              "target_ref": { "$ref": "#/definitions/VmRef" }
            }
          }
        },
        {
          "if": {
            "properties": { "type": { "enum": ["docker", "baremetal"] } },
            "required": ["type"]
          },
          "then": {
            "properties": {
              "target_ref": { "$ref": "#/definitions/DeviceRef" }
            }
          }
        }
      ]
    },
    "DataAsset": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": { "$ref": "#/definitions/DataAssetRef" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/DataAssetType" },
        "category": { "$ref": "#/definitions/DataAssetCategory" },
        "criticality": { "$ref": "#/definitions/DataCriticality" },
        "backup_policy_refs": {
          "type": "array",
          "items": { "$ref": "#/definitions/BackupPolicyRef" }
        },
        "retention_days": { "type": "integer", "minimum": 0 },
        "encryption_at_rest": { "type": "boolean" },
        "engine": { "type": "string" },
        "engine_version": { "type": "string" },
        "device_ref": {
          "$ref": "#/definitions/DeviceRef",
          "x-deprecated": "Prefer L4 placement and L5 runtime linkage for ownership/placement."
        },
        "storage_ref": {
          "$ref": "#/definitions/StorageRef",
          "x-deprecated": "Use L4 storage.volumes[].storage_endpoint_ref or storage_ref."
        },
        "storage_endpoint_ref": {
          "$ref": "#/definitions/StorageEndpointRef",
          "x-deprecated": "Use L4 storage.volumes[].storage_endpoint_ref for placement."
        },
        "mount_point_ref": {
          "type": "string",
          "pattern": "^mnt-[a-z0-9-]+$",
          "x-deprecated": "Use L4 storage.volumes[].mount_path for placement."
        },
        "path": {
          "type": "string",
          "x-deprecated": "Use L4 storage.volumes[].mount_path for placement."
        },
        "description": { "type": "string" }
      },
      "allOf": [
        {
          "anyOf": [
            { "required": ["type"] },
            { "required": ["category"] }
          ]
        },
        {
          "if": {
            "required": ["category"],
            "properties": {
              "category": {
                "enum": ["database", "cache", "timeseries", "search-index", "object-storage"]
              }
            }
          },
          "then": { "required": ["engine"] }
        },
        {
          "if": {
            "required": ["criticality"],
            "properties": {
              "criticality": { "enum": ["high", "critical"] }
            }
          },
          "then": { "required": ["backup_policy_refs"] }
        }
      ]
    },
    "Lxc": {
      "type": "object",
      "required": ["id", "vmid", "name", "device_ref"],
      "properties": {
        "id": { "$ref": "#/definitions/LxcRef" },
        "vmid": { "type": "integer", "minimum": 100, "maximum": 999999999 },
        "name": { "type": "string" },
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "platform_type": { "$ref": "#/definitions/PlatformType" },
        "resource_profile_ref": { "$ref": "#/definitions/ResourceProfileRef" },
        "type": {
          "$ref": "#/definitions/LxcType",
          "x-deprecated": "Use platform_type + L5 service runtime semantics."
        },
        "role": {
          "$ref": "#/definitions/LxcRole",
          "x-deprecated": "Use resource_profile_ref + L5 service runtime semantics."
        },
        "template_ref": { "type": "string" },
        "trust_zone_ref": { "$ref": "#/definitions/TrustZone" },
        "description": { "type": "string" },
        "tags": { "type": "array", "items": { "type": "string" } },
        "resources": {
          "type": "object",
          "x-deprecated": "Use resource_profiles and resource_profile_ref.",
          "properties": {
            "cores": { "type": "integer", "minimum": 1 },
            "memory_mb": { "type": "integer", "minimum": 64 },
            "swap_mb": { "type": "integer", "minimum": 0 }
          }
        },
        "boot": { "type": "object" },
        "storage": { "$ref": "#/definitions/LxcStorage" },
        "networks": { "type": "array" },
        "dns": { "type": "object" },
        "os": {
          "type": "object",
          "properties": {
            "type": { "$ref": "#/definitions/OsType" },
            "version": { "type": "string" }
          }
        },
        "cloudinit": { "type": "object" },
        "ansible": { "type": "object" }
      }
    },
    "Service": {
      "type": "object",
      "required": ["id", "name", "type"],
      "properties": {
        "id": { "$ref": "#/definitions/ServiceRef" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/ServiceType" },
        "runtime": { "$ref": "#/definitions/ServiceRuntime" },
        "network_binding_ref": { "$ref": "#/definitions/NetworkRef" },
        "data_asset_refs": {
          "type": "array",
          "items": { "$ref": "#/definitions/DataAssetRef" }
        },
        "endpoints": {
          "type": "array",
          "items": { "$ref": "#/definitions/ServiceEndpoint" }
        },
        "config": { "type": "object" },
        "device_ref": {
          "$ref": "#/definitions/DeviceRef",
          "x-deprecated": "Use runtime.target_ref with runtime.type."
        },
        "vm_ref": {
          "$ref": "#/definitions/VmRef",
          "x-deprecated": "Use runtime.target_ref with runtime.type."
        },
        "lxc_ref": {
          "$ref": "#/definitions/LxcRef",
          "x-deprecated": "Use runtime.target_ref with runtime.type."
        },
        "network_ref": {
          "$ref": "#/definitions/NetworkRef",
          "x-deprecated": "Use runtime.network_binding_ref."
        },
        "ip": {
          "$ref": "#/definitions/IpAddress",
          "x-deprecated": "Resolve from runtime target + runtime.network_binding_ref."
        },
        "port": { "$ref": "#/definitions/Port" },
        "ports": { "type": "object" },
        "protocol": { "type": "string", "enum": ["http", "https", "tcp", "udp"] },
        "trust_zone_ref": { "$ref": "#/definitions/TrustZone" },
        "url": { "type": "string", "format": "uri" },
        "domain": { "type": "string" },
        "description": { "type": "string" },
        "container": { "type": "boolean" },
        "container_runtime": { "$ref": "#/definitions/ContainerRuntime" },
        "container_image": { "type": "string" },
        "native": { "type": "boolean" },
        "critical": { "type": "boolean" },
        "optional": { "type": "boolean" },
        "dependencies": { "type": "array" },
        "security_policy_ref": { "$ref": "#/definitions/SecurityPolicyRef" },
        "vpn_type": { "$ref": "#/definitions/VpnType" }
      }
    },
    "HealthCheck": {
      "type": "object",
      "required": ["id", "name", "checks"],
      "properties": {
        "id": { "type": "string", "pattern": "^health-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "device_ref": { "$ref": "#/definitions/DeviceRef" },
        "lxc_ref": { "$ref": "#/definitions/LxcRef" },
        "service_ref": { "$ref": "#/definitions/ServiceRef" },
        "enabled": { "type": "boolean" },
        "critical": { "type": "boolean" },
        "checks": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": { "$ref": "#/definitions/HealthCheckType" }
            }
          }
        },
        "interval": { "$ref": "#/definitions/Duration" },
        "timeout": { "$ref": "#/definitions/Duration" },
        "notification": { "type": "object" }
      }
    },
    "Alert": {
      "type": "object",
      "required": ["id", "name", "trigger", "severity"],
      "properties": {
        "id": { "type": "string", "pattern": "^alert-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "trigger": { "type": "object" },
        "severity": { "$ref": "#/definitions/AlertSeverity" },
        "channels": { "type": "array", "items": { "type": "string" } },
        "escalation": { "type": "object" }
      }
    },
    "NotificationChannel": {
      "type": "object",
      "required": ["id", "name", "type"],
      "properties": {
        "id": { "type": "string", "pattern": "^channel-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/NotificationChannelType" },
        "enabled": { "type": "boolean" },
        "config": { "type": "object" }
      }
    },
    "BackupPolicy": {
      "type": "object",
      "required": ["id", "name", "type", "schedule"],
      "properties": {
        "id": { "type": "string", "pattern": "^backup-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "targets": { "type": "array" },
        "type": { "$ref": "#/definitions/BackupType" },
        "schedule": { "$ref": "#/definitions/CronSchedule" },
        "destination": { "type": "object" },
        "compression": { "$ref": "#/definitions/BackupCompression" },
        "retention": { "type": "object" },
        "notification": { "type": "object" },
        "security_policy_ref": { "$ref": "#/definitions/SecurityPolicyRef" }
      }
    },
    "SshKey": {
      "type": "object",
      "required": ["id", "name", "type", "public_key"],
      "properties": {
        "id": { "type": "string", "pattern": "^ssh-[a-z0-9-]+$" },
        "name": { "type": "string" },
        "type": { "$ref": "#/definitions/SshKeyType" },
        "public_key": { "type": "string" },
        "purpose": { "type": "string" },
        "authorized_for": { "type": "array" },
        "created": { "type": "string", "format": "date" },
        "expires": { "oneOf": [{ "type": "string", "format": "date" }, { "type": "null" }] }
      }
    }
  },

  "properties": {
    "L0_meta": {
      "type": "object",
      "required": ["version"],
      "properties": {
        "version": { "type": "string", "pattern": "^4\\." },
        "metadata": {
          "type": "object",
          "properties": {
            "org": { "type": "string" },
            "environment": { "type": "string", "enum": ["production", "staging", "development", "test"] },
            "author": { "type": "string" },
            "created": { "type": "string", "format": "date" },
            "last_updated": { "type": "string", "format": "date" },
            "description": { "type": "string" },
            "changelog": { "type": "array" }
          }
        },
        "defaults": { "type": "object" },
        "security_policy": { "type": "array" }
      }
    },
    "L1_foundation": {
      "type": "object",
      "properties": {
        "locations": {
          "type": "array",
          "items": { "$ref": "#/definitions/Location" }
        },
        "devices": {
          "type": "array",
          "items": { "$ref": "#/definitions/Device" }
        },
        "media_registry": {
          "type": "array",
          "items": { "$ref": "#/definitions/StorageMedia" }
        },
        "media_attachments": {
          "type": "array",
          "items": { "$ref": "#/definitions/StorageMediaAttachment" }
        },
        "data_links": {
          "type": "array",
          "items": { "$ref": "#/definitions/PhysicalLink" }
        },
        "power_links": {
          "type": "array",
          "items": { "$ref": "#/definitions/PowerLink" }
        }
      }
    },
    "L2_network": {
      "type": "object",
      "properties": {
        "trust_zones": {
          "type": "object",
          "patternProperties": {
            "^[a-z][a-z0-9-]*$": { "$ref": "#/definitions/TrustZoneDefinition" }
          },
          "additionalProperties": false
        },
        "network_profiles": {
          "type": "object",
          "patternProperties": {
            "^prof-[a-z0-9-]+$": { "$ref": "#/definitions/NetworkProfile" }
          },
          "additionalProperties": false
        },
        "networks": {
          "type": "array",
          "items": { "$ref": "#/definitions/Network" }
        },
        "bridges": {
          "type": "array",
          "items": { "$ref": "#/definitions/Bridge" }
        },
        "routing": { "type": "array" },
        "firewall_templates": { "type": "array" },
        "firewall_policies": {
          "type": "array",
          "items": { "$ref": "#/definitions/FirewallPolicy" }
        },
        "qos": { "type": "object" },
        "ipv6": { "type": "object" }
      }
    },
    "L3_data": {
      "type": "object",
      "properties": {
        "partitions": {
          "type": "array",
          "items": { "$ref": "#/definitions/Partition" }
        },
        "volume_groups": {
          "type": "array",
          "items": { "$ref": "#/definitions/VolumeGroup" }
        },
        "logical_volumes": {
          "type": "array",
          "items": { "$ref": "#/definitions/LogicalVolume" }
        },
        "filesystems": {
          "type": "array",
          "items": { "$ref": "#/definitions/Filesystem" }
        },
        "mount_points": {
          "type": "array",
          "items": { "$ref": "#/definitions/MountPoint" }
        },
        "storage_endpoints": {
          "type": "array",
          "items": { "$ref": "#/definitions/StorageEndpoint" }
        },
        "storage": {
          "type": "array",
          "x-deprecated": "Use L3 storage_endpoints + chain entities for new model.",
          "items": { "$ref": "#/definitions/Storage" }
        },
        "data_assets": {
          "type": "array",
          "items": { "$ref": "#/definitions/DataAsset" }
        }
      }
    },
    "L4_platform": {
      "type": "object",
      "properties": {
        "_defaults": { "type": "object" },
        "vms": { "type": "array" },
        "resource_profiles": {
          "type": "array",
          "items": { "$ref": "#/definitions/ResourceProfile" }
        },
        "lxc": {
          "type": "array",
          "items": { "$ref": "#/definitions/Lxc" }
        },
        "templates": { "type": "object" }
      }
    },
    "L5_application": {
      "type": "object",
      "properties": {
        "certificates": { "type": "object" },
        "services": {
          "type": "array",
          "items": { "$ref": "#/definitions/Service" }
        },
        "dns": { "type": "object" },
        "external_services": {
          "type": "array",
          "x-deprecated": "Use unified services[].runtime with runtime.type=docker."
        }
      }
    },
    "L6_observability": {
      "type": "object",
      "properties": {
        "healthchecks": {
          "type": "array",
          "items": { "$ref": "#/definitions/HealthCheck" }
        },
        "network_monitoring": { "type": "array" },
        "alerts": {
          "type": "array",
          "items": { "$ref": "#/definitions/Alert" }
        },
        "notification_channels": {
          "type": "array",
          "items": { "$ref": "#/definitions/NotificationChannel" }
        },
        "dashboard": { "type": "object" }
      }
    },
    "L7_operations": {
      "type": "object",
      "properties": {
        "workflows": { "type": "object" },
        "runbooks": { "type": "array" },
        "documentation": { "type": "object" },
        "power_resilience": {
          "type": "object",
          "properties": {
            "policies": {
              "type": "array",
              "items": { "$ref": "#/definitions/PowerPolicy" }
            }
          }
        },
        "notes": { "type": "array", "items": { "type": "string" } },
        "ansible": { "type": "object" },
        "backup": {
          "type": "object",
          "properties": {
            "strategy": { "type": "object" },
            "policies": {
              "type": "array",
              "items": { "$ref": "#/definitions/BackupPolicy" }
            },
            "verification": { "type": "object" },
            "storage_monitoring": { "type": "object" }
          }
        },
        "security": {
          "type": "object",
          "properties": {
            "ssh_keys": {
              "type": "array",
              "items": { "$ref": "#/definitions/SshKey" }
            }
          }
        }
      }
    }
  }
}
