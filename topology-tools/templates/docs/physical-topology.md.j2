# Physical Infrastructure Topology

**Generated from**: topology.yaml v{{ topology_version }}
**Date**: {{ generated_at }}

---

## Device Topology

{% if use_mermaid_icons %}
> {{ mermaid_icon_runtime_hint }}
{% endif %}

```mermaid
graph TB
    subgraph cloud["Cloud Infrastructure"]
        {% for device in devices %}
        {% if device.id in cloud_device_ids %}
        {% set cloud_cpu_cores = device.specs.cpu.cores if device.specs is defined and device.specs.cpu is defined and device.specs.cpu.cores is defined else '?' %}
        {% set cloud_ram_gb = device.specs.memory.total_gb if device.specs is defined and device.specs.memory is defined and device.specs.memory.total_gb is defined else (device.specs.memory.total_mb / 1024 if device.specs is defined and device.specs.memory is defined and device.specs.memory.total_mb is defined else '?') %}
        {% if use_mermaid_icons %}
        {{ device.id | mermaid_id }}@{ icon: "{{ device_icons.get(device.id, 'mdi:devices') }}", form: "{{ icon_node_defaults.form }}", label: "{{ device.name }} {{ cloud_cpu_cores }}C {{ cloud_ram_gb }}GB", pos: "{{ icon_node_defaults.pos }}", h: {{ icon_node_defaults.h }} }
        {% else %}
        {{ device.id | mermaid_id }}["{{ device.name }}<br/>{{ device.model | default(device.type) }}<br/>{{ cloud_cpu_cores }} cores / {{ cloud_ram_gb }}GB"]
        {% endif %}
        {% endif %}
        {% endfor %}
    end

    subgraph home["Home Lab"]
        {% if use_mermaid_icons %}
        internet@{ icon: "mdi:cloud-outline", form: "{{ icon_node_circle.form }}", label: "ISP Internet", pos: "{{ icon_node_circle.pos }}", h: {{ icon_node_circle.h }} }
        {% else %}
        internet(("ISP<br/>Internet"))
        {% endif %}

        {% for device in devices %}
        {% if device.id not in cloud_device_ids %}
        {% if device.type == 'router' %}
        {% set router_cpu_arch = device.specs.cpu.architecture if device.specs is defined and device.specs.cpu is defined and device.specs.cpu.architecture is defined else '' %}
        {% set router_mem_mb = device.specs.memory.total_mb if device.specs is defined and device.specs.memory is defined and device.specs.memory.total_mb is defined else (device.specs.memory.total_gb * 1024 if device.specs is defined and device.specs.memory is defined and device.specs.memory.total_gb is defined else '?') %}
        {% if use_mermaid_icons %}
        {{ device.id | mermaid_id }}@{ icon: "{{ device_icons.get(device.id, 'mdi:router-network') }}", form: "{{ icon_node_defaults.form }}", label: "{{ device.name }} {{ router_cpu_arch }} {{ router_mem_mb }}MB", pos: "{{ icon_node_defaults.pos }}", h: {{ icon_node_defaults.h }} }
        {% else %}
        {{ device.id | mermaid_id }}["{{ device.name }}<br/>{{ device.role }}<br/>{{ router_cpu_arch }} / {{ router_mem_mb }}MB"]
        {% endif %}
        {% elif device.type == 'hypervisor' %}
        {% set hyp_cores = device.specs.cpu.cores if device.specs is defined and device.specs.cpu is defined and device.specs.cpu.cores is defined else '?' %}
        {% set hyp_threads = device.specs.cpu.threads if device.specs is defined and device.specs.cpu is defined and device.specs.cpu.threads is defined else '?' %}
        {% set hyp_ram_gb = device.specs.memory.total_gb if device.specs is defined and device.specs.memory is defined and device.specs.memory.total_gb is defined else '?' %}
        {% if use_mermaid_icons %}
        {{ device.id | mermaid_id }}@{ icon: "{{ device_icons.get(device.id, 'si:proxmox') }}", form: "{{ icon_node_defaults.form }}", label: "{{ device.name }} {{ hyp_cores }}C/{{ hyp_threads }}T {{ hyp_ram_gb }}GB", pos: "{{ icon_node_defaults.pos }}", h: {{ icon_node_defaults.h }} }
        {% else %}
        {{ device.id | mermaid_id }}["{{ device.name }}<br/>Proxmox VE<br/>{{ hyp_cores }}C/{{ hyp_threads }}T / {{ hyp_ram_gb }}GB"]
        {% endif %}
        {% elif device.type == 'sbc' %}
        {% set sbc_cpu_cores = device.specs.cpu.cores if device.specs is defined and device.specs.cpu is defined and device.specs.cpu.cores is defined else '?' %}
        {% set sbc_ram_gb = device.specs.memory.total_gb if device.specs is defined and device.specs.memory is defined and device.specs.memory.total_gb is defined else '?' %}
        {% if use_mermaid_icons %}
        {{ device.id | mermaid_id }}@{ icon: "{{ device_icons.get(device.id, 'mdi:chip') }}", form: "{{ icon_node_defaults.form }}", label: "{{ device.name }} {{ sbc_cpu_cores }}C {{ sbc_ram_gb }}GB", pos: "{{ icon_node_defaults.pos }}", h: {{ icon_node_defaults.h }} }
        {% else %}
        {{ device.id | mermaid_id }}["{{ device.name }}<br/>{{ device.model }}<br/>{{ sbc_cpu_cores }} cores / {{ sbc_ram_gb }}GB"]
        {% endif %}
        {% else %}
        {% if use_mermaid_icons %}
        {{ device.id | mermaid_id }}@{ icon: "{{ device_icons.get(device.id, 'mdi:devices') }}", form: "{{ icon_node_defaults.form }}", label: "{{ device.name }} {{ device.type }}", pos: "{{ icon_node_defaults.pos }}", h: {{ icon_node_defaults.h }} }
        {% else %}
        {{ device.id | mermaid_id }}["{{ device.name }}<br/>{{ device.type }}"]
        {% endif %}
        {% endif %}
        {% endif %}
        {% endfor %}
    end

    %% External physical endpoints from link inventory
    {% for ref in external_refs | default([]) %}
    {% if use_mermaid_icons %}
    ext_{{ ref | mermaid_id }}@{ icon: "{{ external_icons.get(ref, 'mdi:help-circle-outline') }}", form: "{{ icon_node_circle.form }}", label: "{{ ref }}", pos: "{{ icon_node_circle.pos }}", h: {{ icon_node_circle.h }} }
    {% else %}
    ext_{{ ref | mermaid_id }}["{{ ref }}"]
    {% endif %}
    {% endfor %}

    %% Connections
    {% if physical_links %}
    {% for link in physical_links %}
    {% set src = link.endpoint_a.device_ref if link.endpoint_a.device_ref is defined else ('ext_' ~ (link.endpoint_a.external_ref | mermaid_id)) %}
    {% set dst = link.endpoint_b.device_ref if link.endpoint_b.device_ref is defined else ('ext_' ~ (link.endpoint_b.external_ref | mermaid_id)) %}
    {% set speed_label = (link.speed_mbps ~ 'Mbps') if link.speed_mbps is defined else '' %}
    {% if link.medium in ['wifi', 'lte'] %}
    {{ src | mermaid_id }} -.->|{{ link.medium | upper }}{% if speed_label %}<br/>{{ speed_label }}{% endif %}| {{ dst | mermaid_id }}
    {% else %}
    {{ src | mermaid_id }} -->|{{ link.medium | upper }}{% if speed_label %}<br/>{{ speed_label }}{% endif %}| {{ dst | mermaid_id }}
    {% endif %}
    {% endfor %}
    {% else %}
    internet -->|WAN 2.5GbE| mikrotik_chateau
    {% for device in devices %}
    {% if device.location == 'home' and device.type != 'router' %}
    mikrotik_chateau -->|1GbE| {{ device.id | mermaid_id }}
    {% endif %}
    {% endfor %}
    {% endif %}

    %% Styling
    classDef router fill:#4dabf7,stroke:#1864ab,color:#fff
    classDef server fill:#51cf66,stroke:#2b8a3e,color:#000
    classDef sbc fill:#ffd43b,stroke:#fab005,color:#000
    classDef cloud fill:#ffc078,stroke:#e8590c,color:#000
    classDef internet fill:#ff6b6b,stroke:#c92a2a,color:#fff
    classDef external fill:#adb5bd,stroke:#495057,color:#000

    class internet internet
    {% for ref in external_refs | default([]) %}
    class ext_{{ ref | mermaid_id }} external
    {% endfor %}
    {% for device in devices %}
    {% if device.id in cloud_device_ids %}
    class {{ device.id | mermaid_id }} cloud
    {% elif device.type == 'router' %}
    class {{ device.id | mermaid_id }} router
    {% elif device.type == 'hypervisor' %}
    class {{ device.id | mermaid_id }} server
    {% elif device.type == 'sbc' %}
    class {{ device.id | mermaid_id }} sbc
    {% endif %}
    {% endfor %}
```

---

## Physical Link Inventory

| Link ID | Endpoint A | Endpoint B | Medium | Speed | VLAN Trunk | Status |
|---------|------------|------------|--------|-------|------------|--------|
{% for link in physical_links | default([]) %}
| {{ link.id }} | {{ link.endpoint_a.device_ref | default(link.endpoint_a.external_ref) }}{% if link.endpoint_a.interface_ref is defined %} ({{ link.endpoint_a.interface_ref }}){% endif %} | {{ link.endpoint_b.device_ref | default(link.endpoint_b.external_ref) }}{% if link.endpoint_b.interface_ref is defined %} ({{ link.endpoint_b.interface_ref }}){% endif %} | {{ link.medium | upper }} | {{ link.speed_mbps | default('-') }}{% if link.speed_mbps is defined %} Mbps{% endif %} | {{ 'Yes' if link.vlan_trunk else 'No' }} | {{ link.status | default('-') }} |
{% endfor %}

---

Overlay (VPN/mesh) links are documented separately in `vpn-topology.md`.

---

## Device Inventory

| Device | Type | Location | CPU | RAM | Role |
|--------|------|----------|-----|-----|------|
{% for device in devices %}
{% set cpu_label = '-' %}
{% if device.specs is defined and device.specs.cpu is defined %}
{% if device.specs.cpu.model is defined %}
{% set cpu_label = device.specs.cpu.model %}
{% elif device.specs.cpu.cores is defined %}
{% set cpu_label = device.specs.cpu.cores ~ ' cores' %}
{% endif %}
{% endif %}
{% set ram_label = '-' %}
{% if device.specs is defined and device.specs.memory is defined %}
{% if device.specs.memory.total_gb is defined %}
{% set ram_label = device.specs.memory.total_gb ~ 'GB' %}
{% elif device.specs.memory.total_mb is defined %}
{% set ram_label = (device.specs.memory.total_mb / 1024) ~ 'GB' %}
{% endif %}
{% endif %}
| **{{ device.name }}** | {{ device.type }} | {{ device.location }} | {{ cpu_label }} | {{ ram_label }} | {{ device.role }} |
{% endfor %}

---

## Network Interfaces

{% for device in devices %}
### {{ device.name }}

| Interface | Type | Speed | Role | Description |
|-----------|------|-------|------|-------------|
{% for iface in device.interfaces | default([]) %}
| {{ iface.name }} | {{ iface.type }} | {{ iface.speed_mbps | default('?') }} Mbps | {{ iface.role }} | {{ iface.description | default('-') }} |
{% endfor %}

{% endfor %}

---

## Storage Summary

{% for device in devices %}
{% if device.specs is defined and device.specs.storage_slots is defined and device.specs.storage_slots %}
### {{ device.name }} Storage

| Disk ID | Size | Type | Mount | Slot/Port | State | Usage |
|---------|------|------|-------|------|-------|-------|
{% for slot in device.specs.storage_slots %}
{% if slot.media is defined and slot.media %}
| {{ slot.media.id }} | {{ slot.media.size_gb }}GB | {{ slot.media.type | upper }} | {{ slot.mount | default('replaceable') }} | {{ slot.id | default('-') }} | {{ slot.media.state | default('present') }} | {{ slot.media.usage | default('-') }} |
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

---

## Power Consumption

| Device | Max Power | Notes |
|--------|-----------|-------|
{% for device in devices %}
{% if device.power is defined %}
| {{ device.name }} | {{ device.power.max_watts | default(device.power.typical_watts | default('?')) }}W | {{ device.power.psu | default(device.power.input_voltage | default('-')) }} |
{% endif %}
{% endfor %}

---

**DO NOT EDIT MANUALLY** - Regenerate with `python3 topology-tools/generate-docs.py`
